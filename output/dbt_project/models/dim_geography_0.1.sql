-- Migrated Job: dim_geography_0.1
WITH 
tDBInput_1 AS ( 
    SELECT 
  AW2017NEU_PERSON.ADDRESS.ADDRESSID, 
  AW2017NEU_PERSON.ADDRESS.ADDRESSLINE1, 
  AW2017NEU_PERSON.ADDRESS.ADDRESSLINE2, 
  AW2017NEU_PERSON.ADDRESS.CITY, 
  AW2017NEU_PERSON.ADDRESS.STATEPROVINCEID, 
  AW2017NEU_PERSON.ADDRESS.POSTALCODE
FROM AW2017NEU_PERSON.ADDRESS 
),
tDBInput_3 AS ( 
    SELECT 
  AW2017NEU_PERSON.COUNTRYREGION.COUNTRYREGIONCODE, 
  AW2017NEU_PERSON.COUNTRYREGION.COUNTRYREGIONNAME
FROM AW2017NEU_PERSON.COUNTRYREGION 
),
tDBInput_4 AS ( 
    SELECT 
  AW2017NEU_PERSON.STATEPROVINCE.STATEPROVINCEID, 
  AW2017NEU_PERSON.STATEPROVINCE.STATEPROVINCECODE, 
  AW2017NEU_PERSON.STATEPROVINCE.COUNTRYREGIONCODE, 
  AW2017NEU_PERSON.STATEPROVINCE.ISONLYSTATEPROVINCEFLAG, 
  AW2017NEU_PERSON.STATEPROVINCE.STATEPROVINCENAME, 
  AW2017NEU_PERSON.STATEPROVINCE.TERRITORYID
FROM AW2017NEU_PERSON.STATEPROVINCE 
),
tMap_1 AS (
 WITH tDBInput_1 AS (SELECT * FROM address), tDBInput_3 AS (SELECT * FROM country), tDBInput_4 AS (SELECT * FROM stateprovince) SELECT t1.CITY AS City, row_number() OVER () AS Geographykey, t4.STATEPROVINCECODE AS StateProvinceCode, 0 AS IsOnlyStateProvinceFlag, t4.STATEPROVINCENAME AS StateProvinceName, t3.COUNTRYREGIONNAME AS CountryRegionName, t4.COUNTRYREGIONCODE AS CountryRegionCode, t1.POSTALCODE AS PostalCode, context.getProperty('vJobPID') AS DI_JobID, current_date AS DI_CreatedDate, current_date AS DI_ModifiedDate, NULL AS salesTerritoryKey, 2 AS SOR_ID FROM tDBInput_1 AS t1 INNER JOIN tDBInput_4 AS t4 ON t1.STATEPROVINCEID = t4.STATEPROVINCEID INNER JOIN tDBInput_3 AS t3 ON t4.COUNTRYREGIONCODE = t3.COUNTRYREGIONCODE 
),
final_cte AS ( SELECT * FROM tMap_1 )

SELECT * FROM final_cte